<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>狂猎小鸭 - 难度进阶版</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: 'Arial', sans-serif; cursor: crosshair; }
        canvas { display: block; background: #87CEEB; /* 天蓝色背景 */ }
        #ui {
            position: absolute; top: 20px; left: 20px; color: white;
            text-shadow: 2px 2px 4px #000; pointer-events: none;
        }
        .msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; text-align: center; display: none;
        }
        button {
            padding: 10px 20px; font-size: 20px; cursor: pointer;
            background: #ff4757; color: white; border: none; border-radius: 5px;
        }
    </style>
</head>
<body>

<div id="ui">
    <h2>关卡: <span id="lvl">1</span></h2>
    <p>分数: <span id="score">0</span></p>
    <p>逃跑鸭子: <span id="escaped">0</span> / 5</p>
</div>

<div id="gameover" class="msg">
    <h1>游戏结束!</h1>
    <button onclick="resetGame()">重新开始</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const lvlEl = document.getElementById('lvl');
const escapedEl = document.getElementById('escaped');
const gameoverEl = document.getElementById('gameover');

// 游戏状态
let score = 0;
let level = 1;
let escaped = 0;
let isGameOver = false;
let ducks = [];
let lastSpawn = 0;

// 配置
const config = {
    spawnRate: 1500, // 初始生成间隔 (ms)
    maxEscaped: 5,
    baseSpeed: 2
};

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

class Duck {
    constructor() {
        this.r = 25 + Math.random() * 15; // 鸭子大小
        this.x = Math.random() * (canvas.width - this.r * 2) + this.r;
        this.y = canvas.height + this.r;
        // 难度成长：速度随等级提升
        this.speed = config.baseSpeed + (level * 0.8);
        this.vx = (Math.random() - 0.5) * 4; // 左右随机漂移
        this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
        this.isHit = false;
    }

    update() {
        this.y -= this.speed;
        this.x += this.vx;
        
        // 碰到边界反弹
        if (this.x - this.r < 0 || this.x + this.r > canvas.width) this.vx *= -1;
    }

    draw() {
        ctx.beginPath();
        ctx.fillStyle = this.color;
        // 画一个简单的鸭子形状（身体+头部）
        ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2); 
        ctx.fill();
        // 眼睛
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(this.x + 10, this.y - 10, 3, 0, Math.PI * 2);
        ctx.fill();
        // 嘴巴
        ctx.fillStyle = "orange";
        ctx.fillRect(this.x + this.r - 5, this.y - 5, 15, 10);
    }
}

function spawnDuck(timestamp) {
    if (timestamp - lastSpawn > Math.max(500, config.spawnRate - (level * 100))) {
        ducks.push(new Duck());
        lastSpawn = timestamp;
    }
}

function animate(timestamp) {
    if (isGameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 绘制草地（简单的装饰）
    ctx.fillStyle = "#2ed573";
    ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

    spawnDuck(timestamp);

    ducks.forEach((duck, index) => {
        duck.update();
        duck.draw();

        // 检查是否飞出屏幕顶部
        if (duck.y + duck.r < 0) {
            ducks.splice(index, 1);
            escaped++;
            escapedEl.innerText = escaped;
            if (escaped >= config.maxEscaped) endGame();
        }
    });

    requestAnimationFrame(animate);
}

// 射击检测
canvas.addEventListener('mousedown', (e) => {
    if (isGameOver) return;
    
    const mouseX = e.clientX;
    const mouseY = e.clientY;

    for (let i = ducks.length - 1; i >= 0; i--) {
        const d = ducks[i];
        const dist = Math.hypot(mouseX - d.x, mouseY - d.y);
        
        if (dist < d.r) {
            // 击中！
            ducks.splice(i, 1);
            score += 10;
            scoreEl.innerText = score;
            
            // 每得到100分升一级
            if (score > 0 && score % 100 === 0) {
                level++;
                lvlEl.innerText = level;
            }
            break;
        }
    }
});

function endGame() {
    isGameOver = true;
    gameoverEl.style.display = 'block';
}

function resetGame() {
    score = 0;
    level = 1;
    escaped = 0;
    ducks = [];
    isGameOver = false;
    scoreEl.innerText = 0;
    lvlEl.innerText = 1;
    escapedEl.innerText = 0;
    gameoverEl.style.display = 'none';
    requestAnimationFrame(animate);
}

// 窗口自适应
window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

requestAnimationFrame(animate);
</script>
</body>
</html>
